connect system/manager as sysdba

DROP USER test CASCADE;
CREATE USER test IDENTIFIED BY test;
GRANT DBA TO test;

connect test/test;

SET SERVEROUTPUT ON;

--OBJETO Y UBICACION
CREATE OR REPLACE TYPE UBICACION_TYP AS OBJECT (
    CALLE   INTEGER,    -- CALLE EN LA QUE SE ENCUENTRA
    AV1     INTEGER,    -- ENTRE AV1
    AV2     INTEGER,    -- Y AV2
    POS     INTEGER     -- POSICION (1, 2, 3)
)
/

--OBJETO Y TABLA TOMA
CREATE OR REPLACE TYPE TOMA_TYP AS OBJECT (
    TAMANNO INTEGER     -- PULGADAS 
)
/

CREATE OR REPLACE TYPE COLLECTION_TOMAS IS TABLE OF TOMA_TYP;
/

-- DD: DECIMAL DEGREES
-- ESTO YA TIENE UN CONSTRUCTOR POR DEFAULT QUE ES "GRADO_TYP(GRADOS, MINUTOS, SEGUNDOS)"
CREATE OR REPLACE TYPE GRADO_TYP AS OBJECT (
    GRADOS      INTEGER,
    MINUTOS     INTEGER,
    SEGUNDOS    INTEGER,
    CONSTRUCTOR FUNCTION    GRADO_TYP (DD FLOAT) RETURN SELF AS RESULT,
    MEMBER      FUNCTION    TO_DD     RETURN FLOAT,
    MEMBER      FUNCTION    TO_STRING RETURN VARCHAR2
);
/

CREATE OR REPLACE TYPE BODY GRADO_TYP IS
    CONSTRUCTOR FUNCTION GRADO_TYP (DD FLOAT) 
    RETURN SELF AS RESULT IS
    BEGIN 
        SELF.GRADOS := FLOOR(DD);
        SELF.MINUTOS := FLOOR( (DD - SELF.GRADOS) * 60 );
        SELF.SEGUNDOS := ( DD - SELF.GRADOS - SELF.MINUTOS / 60 ) * 3600;
        RETURN;
    END;

    MEMBER FUNCTION TO_DD 
    RETURN FLOAT IS 
        DD FLOAT;
    BEGIN 
        DD := SELF.GRADOS + (SELF.MINUTOS / 60) + (SELF.SEGUNDOS / 3600);
        RETURN DD;
    END;

    MEMBER FUNCTION TO_STRING
    RETURN VARCHAR2 IS
        STR VARCHAR2(100);
    BEGIN
        STR := SELF.GRADOS || '° ' || SELF.MINUTOS || ''' ' || SELF.SEGUNDOS || '"';
        RETURN STR;
    END;

END;
/


--  NO SE CUAL ES EL FORMATO QUE QUIERE UTILIZAR EL PROFE, YA LE PREGUNTÉ
-- AL ASISTENTE, PERO ME DICE QUE SEGURO ES DEL FORMATO DMS (DEGREES, MINUTES, SECONDS)
CREATE OR REPLACE TYPE GPS_TYP AS OBJECT (
    LAT FLOAT,  -- LAT: DECIMAL DEGREES:    9.97089
    LNG FLOAT   -- LNG: DECIMAL DEGREES:  -87.1290535
)
/

CREATE OR REPLACE TYPE CAUDAL_TYP AS OBJECT (
    -- CAUDAL = LITROS / SEGUNDOS.
    VALOR_ESPERADO  INTEGER,
    VALOR_REAL      INTEGER
)
/

CREATE OR REPLACE TYPE HIDRANTE_TYP AS OBJECT (
    UBIC    UBICACION_TYP,
    TOMAS   COLLECTION_TOMAS,
    CAUDAL  CAUDAL_TYP,
    GPS     GPS_TYP,
    ESTADO  INTEGER
    -- BODY
    -- MEMBER FUNCTION NAME RETURN INTEGER,
)
/

-- CREATE OR REPLACE TYPE BODY HIDRANTE_TYP AS 
-- 
-- END;
-- /


-- TESTING DEGREES
DECLARE 
    G GRADO_TYP;
BEGIN
    DBMS_OUTPUT.PUT_LINE('PART I');
    G := GRADO_TYP(21.76);
    DBMS_OUTPUT.PUT_LINE(G.TO_DD);
    DBMS_OUTPUT.PUT_LINE(G.TO_STRING);
    DBMS_OUTPUT.PUT_LINE('PART II');
    G := GRADO_TYP(21, 30, 50);
    DBMS_OUTPUT.PUT_LINE(G.TO_DD);
    DBMS_OUTPUT.PUT_LINE(G.TO_STRING);
    DBMS_OUTPUT.PUT_LINE('FINISHED MAN');
END;
/